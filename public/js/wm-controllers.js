!function(e,t,n){"use strict";wmApp.controller("authCtrl",["$scope","$http","$state","authAPI","$localStorage","$timeout",function(e,t,n,s,l,a){function r(){return c(),0===e.auth.username.length?(e.usernameError="Please enter a username.",!1):e.auth.username.length<3?(e.usernameError="Username must be greater than 3 characters long.",!1):0===e.auth.pass.length?(e.passError="Please enter a password.",!1):e.auth.pass.length<5?(e.passError="Password must be greater than 6 characters long.",!1):e.auth.confirmPass===e.auth.pass||(e.confirmPassError="Passwords must match.",!1)}function o(){return c(),0===e.auth.username.length?(e.usernameError="Please enter your username.",!1):0!==e.auth.pass.length||(e.passError="Please enter your password.",!1)}function c(){e.usernameError=null,e.passError=null,e.confirmPassError=null,e.serverError=null,e.serverSuccess=null}e.registerUser=function(){if(e.registeringUser=!0,!r())return e.registeringUser=!1,!1;console.log("Attempting to register user..."),s.registerUser(e.auth.username,e.auth.pass).then(function(t){console.log(t),e.serverSuccess=t.data,a(function(){e.registeringUser=!1,n.go("login")},500)},function(t){console.log(t),e.serverError=t.data,e.registeringUser=!1})},e.loginUser=function(){if(e.loggingUser=!0,!o())return e.loggingUser=!1,!1;s.loginUser(e.auth.username,e.auth.pass).then(function(t){console.log(t),l.currentUser=t.data,e.loggingUser=!1,n.go("home")},function(t){console.log(t),e.serverError=t.data,e.loggingUser=!1}),e.loggingUser=!1},e.auth={username:"",pass:"",confirmPass:""}}]),wmApp.controller("homeCtrl",["$rootScope","$localStorage","$scope",function(e,t,n){console.log("homeCtrl: ",e.currentUser)}]),wmApp.controller("indexCtrl",["$rootScope","$scope","$state","authAPI",function(e,t,n,s){t.logout=function(){s.logout()},t.$state=n}]),wmApp.controller("modalSaveTalentCtrl",["$scope","close","$location","talentHelper",function(e,t,n,s){function l(){return e.name?e.name.length<2||e.name.length>20?(e.nameError="Name must be between 2 and 20 characters long.",!1):""!==n.search().talents||(e.nameError="You cannot save an empty talent tree.",!1):(e.nameError="Enter a name please.",!1)}e.name=null,e.closeModal=function(){e.destroying=!0,t(!1,250)},e.save=function(){!0===l()&&(e.destroying=!0,t({talents:n.search().talents,glyphs:n.search().glyphs,name:e.name},250))},e.savedTalents=s.getAllSavedTalents()}]),wmApp.controller("plannerCtrl",["$scope","$state",function(e,t){}]),wmApp.controller("stylesCtrl",["$scope",function(e){}]),wmApp.controller("talentCalcCtrl",["$rootScope","$scope","talentHelper","$stateParams","$state","talentDetails","talentTooltips","talentGlyphs","ModalService",function(e,t,s,l,a,r,o,c,u){function i(e){s.clearTalents(t.talentsSpent,t.talentsSpentDetails,t.classId,r,e)}function p(){t.curGlyphs=s.clearGlyphs(t.curGlyphs)}t.classes=classesToString,t.specs=specsToString,t.urlTalents=s.getUrlTalents(),t.urlGlyphs=s.getUrlGlyphs(),t.classId=l.class,t.talentDetails=r,t.talentTooltips=o,t.talentsSpentDetails={},t.talentsSpent={},t.talentGlyphs=c,t.curGlyphs={},t.savedTalents=[],e.showGlyphSelection=!1,t.changeClass=function(e){a.go("talent-calculator",{class:e,talents:"",glyphs:""})},t.validClassId=function(){return!(""===t.classId||!t.classId||!t.classes[t.classId])},t.clearTalents=i,t.clearGlyphs=p,t.showGlyphSelectionModal=function(n,s){e.showGlyphSelection=!0,t.glyphSelectionType=s,t.glyphSelectionIndex=n,e.isModalOpen=!0},t.getGlyphTooltip=function(e,t){return s.getGlyphTooltip(e,t,s.getGlyphImgPath(e))},t.goToSavedTalent=function(e){a.go("talent-calculator",{class:e.classId,talents:e.talents,glyphs:e.glyphs},{reload:!0})},t.showSavedTalents=function(){if(!e.currentUser)return!1;u.showModal(g).then(function(n){n.close.then(function(n){if(n){var l={name:n.name,classId:t.classId,talents:n.talents,glyphs:n.glyphs,preview:[t.talentsSpentDetails[0].total,t.talentsSpentDetails[1].total,t.talentsSpentDetails[2].total]};s.saveTalent(l,e.currentUser.username).then(function(e){e?(console.log(e),s.addSavedTalent(e.data),t.showSlideoutPreview=!0):console.log("No response...")},function(e){console.log(e)})}})})};var g={templateUrl:"/partials/wm-modal-save-talent.html",bodyClass:"modal-open",controller:"modalSaveTalentCtrl"};t.classId&&(i(),p(),t.urlTalents&&s.initTalents(r,t.urlTalents,t.talentsSpent,t.talentsSpentDetails),t.urlGlyphs&&s.initGlyphs(t.urlGlyphs,t.curGlyphs,t.talentGlyphs)),e.currentUser&&function(e){var l=s.getAllSavedTalents();!!e&&(l!==n?(t.savedTalents=l,t.savedTalents.length>0&&(t.showSlideoutPreview=!0)):s.getTalents(e).then(function(e){e&&e.data&&(console.log(e),s.initSavedTalents(e.data.talents),t.savedTalents=e.data.talents,t.savedTalents.length>0&&(t.showSlideoutPreview=!0))},function(e){console.log(e)}))}(e.currentUser.username)}])}(window,document);